@inject ISignInService SignInService
@inject NavigationManager NavigationManager

<nav >
   

    <div class="user-actions">
        @if (SignInService.IsSignedIn)
        {
            <span>Hello, @SignInService.CurrentUser?.Username!</span>
            <button class="btn" @onclick="SignOut">Sign Out</button>
        }
        else
        {
            <button class="btn" @onclick="SignIn">Sign In</button>
        }
    </div>
</nav>

@code {
    private Func<Task>? _onChangeHandler;

    protected override void OnInitialized()
    {
        _onChangeHandler = async () =>
           {
               await InvokeAsync(StateHasChanged);
           };

        SignInService.OnChange += _onChangeHandler;
    }

    public void Dispose()
    {
        if (_onChangeHandler != null)
            SignInService.OnChange -= _onChangeHandler;
    }

    private void SignIn()
    {
        NavigationManager.NavigateTo("/signin"); 
    }

    private async Task SignOut()
    {
        await SignInService.SignOutAsync();
   
        NavigationManager.NavigateTo("/signin", forceLoad: true);
    }
}
